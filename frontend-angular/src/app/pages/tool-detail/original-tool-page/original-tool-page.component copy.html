<!-- Original Tool Page Implementation -->
<div class="original-tool-page">
  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading tool...</p>
  </div>

  <!-- Not Found State -->
  <div *ngIf="notFound()" class="error-container">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <h2>Tool Not Found</h2>
    <p>The requested tool could not be found.</p>
    <button mat-raised-button color="primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Back to Tools
    </button>
  </div>

  <!-- Tool Content -->
  <div *ngIf="software()?.biotoolsID && !loading()" class="container">
    <div class="tool-page-content">
      
      <!-- Tool Header -->
      <div class="tool-header-section">
        <div class="header-content">
          <h1>{{ software()?.name }}</h1>
          <p class="tool-description">{{ software()?.description }}</p>
          <div class="tool-metadata">
            <span *ngIf="software()?.version" class="version">Version: {{ software()?.version }}</span>
            <span *ngIf="software()?.biotoolsID" class="biotools-id">ID: {{ software()?.biotoolsID }}</span>
          </div>
        </div>
        <div class="header-actions">
          <button mat-raised-button color="primary" *ngIf="software()?.homepage" 
                  (click)="openHomepage()">
            <mat-icon>home</mat-icon>
            Homepage
          </button>
          <button mat-stroked-button (click)="goBack()">
            <mat-icon>arrow_back</mat-icon>
            Back
          </button>
        </div>
      </div>

      <!-- Tool Summary -->
      <div class="tool-summary-section">
        <div class="summary-content">
          <div class="summary-grid">
            <div *ngIf="software()?.toolType?.length" class="summary-item">
              <h4>Tool Types</h4>
              <div class="tags">
                <span *ngFor="let type of software()?.toolType" class="tag">{{ type.term }}</span>
              </div>
            </div>
            <div *ngIf="software()?.topic?.length" class="summary-item">
              <h4>Topics</h4>
              <div class="tags">
                <span *ngFor="let topic of software()?.topic" class="tag">{{ topic.term }}</span>
              </div>
            </div>
            <div *ngIf="software()?.operatingSystem?.length" class="summary-item">
              <h4>Operating Systems</h4>
              <div class="tags">
                <span *ngFor="let os of software()?.operatingSystem" class="tag">{{ os }}</span>
              </div>
            </div>
            <div *ngIf="software()?.language?.length" class="summary-item">
              <h4>Programming Languages</h4>
              <div class="tags">
                <span *ngFor="let lang of software()?.language" class="tag">{{ lang }}</span>
              </div>
            </div>
            <div *ngIf="software()?.license" class="summary-item">
              <h4>License</h4>
              <div class="tags">
                <span class="tag">{{ software()?.license }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tool Operation (Input → Function → Output) -->
      <div *ngIf="software()?.function?.length" class="tool-operation-section">
        <div *ngFor="let func of software()?.function" class="function-row">
          <div class="function-flow">
            
            <!-- Inputs -->
            <div class="function-inputs">
              <div *ngFor="let input of func.input; let last = last" class="input-item">
                <div class="data-element">
                  <h5>
                    <a class="data-link">{{ input.term }} ›</a>
                    <span *ngIf="input.format?.length" class="format-info">
                      <br>(
                      <span *ngFor="let format of input.format; let formatLast = last">
                        <a class="format-link">{{ format.term }} ›</a>
                        <span *ngIf="!formatLast">, </span>
                      </span>)
                    </span>
                  </h5>
                </div>
                <div class="arrow-container" *ngIf="!last">
                  <mat-icon class="flow-arrow">arrow_forward</mat-icon>
                </div>
              </div>
            </div>

            <!-- Mobile Arrow -->
            <div class="mobile-arrow" *ngIf="func.input?.length">
              <mat-icon class="flow-arrow">arrow_downward</mat-icon>
            </div>

            <!-- Function/Operation -->
            <div class="function-operation">
              <div class="operation-content">
                <mat-icon *ngIf="func.note" class="info-icon" [matTooltip]="func.note">help_outline</mat-icon>
                <div class="operation-list">
                  <div *ngIf="!func.operation?.length" class="operation-item">
                    <h5>{{ software()?.name }}</h5>
                  </div>
                  <div *ngFor="let operation of func.operation" class="operation-item">
                    <h5>
                      <a class="operation-link" *ngIf="operation.term !== 'N/A' && operation.term">
                        {{ operation.term }} ›
                      </a>
                    </h5>
                  </div>
                </div>
                <code *ngIf="func.cmd" class="command-code">{{ func.cmd }}</code>
              </div>
            </div>

            <!-- Outputs -->
            <div class="function-outputs">
              <div *ngFor="let output of func.output; let last = last" class="output-item">
                <div class="arrow-container">
                  <mat-icon class="flow-arrow">arrow_forward</mat-icon>
                </div>
                <div class="data-element">
                  <h5>
                    <a class="data-link">{{ output.term }} ›</a>
                    <span *ngIf="output.format?.length" class="format-info">
                      <br>(
                      <span *ngFor="let format of output.format; let formatLast = last">
                        <a class="format-link">{{ format.term }} ›</a>
                        <span *ngIf="!formatLast">, </span>
                      </span>)
                    </span>
                  </h5>
                </div>
              </div>
            </div>
          </div>
          
          <p *ngIf="func.note" class="function-note">{{ func.note }}</p>
        </div>
      </div>

      <!-- Secondary Sections Row -->
      <div class="secondary-sections-row">
        
        <!-- Credits -->
        <div *ngIf="hasCredits()" class="section-column">
          <div class="section-divider">
            <span>Credits & Support</span>
          </div>
          <div class="credits-content">
            <div *ngFor="let credit of software()?.credit" class="credit-callout">
              <div class="credit-header">
                <strong *ngIf="credit.name">{{ credit.name }}</strong>
                <div class="credit-links">
                  <a *ngIf="credit.email" [href]="'mailto:' + credit.email" class="credit-link">
                    <mat-icon>email</mat-icon>
                  </a>
                  <a *ngIf="credit.url" [href]="credit.url" target="_blank" class="credit-link">
                    <mat-icon>link</mat-icon>
                  </a>
                  <a *ngIf="credit.orcidid" [href]="'https://orcid.org/' + credit.orcidid" target="_blank" class="credit-link">
                    <mat-icon>person</mat-icon>
                  </a>
                </div>
              </div>
              <div *ngIf="credit.typeEntity" class="credit-entity">{{ credit.typeEntity }}</div>
              <div *ngIf="credit.typeRole?.length" class="credit-roles">
                <span *ngFor="let role of credit.typeRole" class="role-tag">{{ role }}</span>
              </div>
              <p *ngIf="credit.note" class="credit-note">{{ credit.note }}</p>
            </div>
          </div>
        </div>

        <!-- Documentation -->
        <div *ngIf="hasDocumentation()" class="section-column">
          <div class="section-divider">
            <span>Documentation</span>
          </div>
          <div class="documentation-content">
            <div *ngFor="let doc of software()?.documentation" class="doc-callout">
              <div class="doc-header">
                <mat-icon class="doc-icon">description</mat-icon>
                <div class="doc-info">
                  <strong>{{ doc.type }}</strong>
                  <a [href]="doc.url" target="_blank" class="doc-link">{{ doc.url }}</a>
                </div>
              </div>
              <p *ngIf="doc.note" class="doc-note">{{ doc.note }}</p>
            </div>
          </div>
        </div>

        <!-- Downloads -->
        <div *ngIf="hasDownloads()" class="section-column">
          <div class="section-divider">
            <span>Downloads</span>
          </div>
          <div class="downloads-content">
            <div *ngFor="let download of software()?.download" class="download-callout">
              <div class="download-header">
                <mat-icon class="download-icon">download</mat-icon>
                <div class="download-info">
                  <strong>{{ download.type }}</strong>
                  <a [href]="download.url" target="_blank" class="download-link">{{ download.url }}</a>
                </div>
              </div>
              <p *ngIf="download.note" class="download-note">{{ download.note }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Publications Detail -->
      <div *ngIf="hasPublications()" class="publications-detail-section">
        <div class="section-divider">
          <span>Publications</span>
        </div>
        <div class="publications-content">
          <div *ngFor="let pub of software()?.publication" class="publication-item">
            <div class="publication-header">
              <div class="publication-type">
                <span class="type-badge" [class]="pub.type?.[0] === 'Primary' ? 'primary' : 'secondary'">
                  {{ pub.type?.[0] || 'Publication' }}
                </span>
              </div>
            </div>
            <div class="publication-ids">
              <div *ngIf="pub.doi" class="publication-id">
                <strong>DOI:</strong> 
                <a [href]="'https://doi.org/' + pub.doi" target="_blank">{{ pub.doi }}</a>
              </div>
              <div *ngIf="pub.pmid" class="publication-id">
                <strong>PMID:</strong> 
                <a [href]="'https://pubmed.ncbi.nlm.nih.gov/' + pub.pmid" target="_blank">{{ pub.pmid }}</a>
              </div>
              <div *ngIf="pub.pmcid" class="publication-id">
                <strong>PMCID:</strong> 
                <a [href]="'https://www.ncbi.nlm.nih.gov/pmc/articles/' + pub.pmcid" target="_blank">{{ pub.pmcid }}</a>
              </div>
            </div>
            <p *ngIf="pub.note" class="publication-note">{{ pub.note }}</p>
            <p *ngIf="pub.version" class="publication-version"><strong>Version:</strong> {{ pub.version }}</p>
          </div>
        </div>
      </div>

      <!-- ELIXIR Info -->
      <div class="elixir-info-section">
        <div class="section-divider">
          <span>ELIXIR bio.tools</span>
        </div>
        <div class="elixir-content">
          <div class="elixir-text">
            <p>
              This tool description is part of ELIXIR bio.tools, a comprehensive registry of 
              software tools and data resources for the life sciences.
            </p>
            <div class="elixir-metadata">
              <div class="metadata-item">
                <strong>bio.tools ID:</strong> {{ software()?.biotoolsID }}
              </div>
              <div *ngIf="software()?.additionDate" class="metadata-item">
                <strong>Added:</strong> {{ software()?.additionDate | date }}
              </div>
              <div *ngIf="software()?.lastUpdate" class="metadata-item">
                <strong>Updated:</strong> {{ software()?.lastUpdate | date }}
              </div>
            </div>
            <div class="elixir-actions">
              <button mat-raised-button color="primary" 
                      (click)="openBiotoolsEntry()">
                <mat-icon>open_in_new</mat-icon>
                View in bio.tools
              </button>
            </div>
          </div>
          <div class="elixir-logo">
            <img src="/img/ELIXIR_logo_white_background.png" alt="ELIXIR Logo" class="logo-image">
          </div>
        </div>
      </div>

      <!-- Community -->
      <div class="community-section">
        <div class="section-divider">
          <span>Community</span>
        </div>
        <div class="community-content">
          <div class="community-text">
            <h4>Get Involved</h4>
            <p>Help improve this tool description by contributing to the bio.tools community.</p>
            <div class="community-actions">
              <button mat-raised-button color="accent">
                <mat-icon>group_add</mat-icon>
                Join Community
              </button>
              <button mat-stroked-button>
                <mat-icon>forum</mat-icon>
                Discussions
              </button>
              <button mat-stroked-button>
                <mat-icon>help</mat-icon>
                Get Help
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
