<!-- Original Tool Page Implementation -->
<div class="original-tool-page">
  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading tool...</p>
  </div>

  <!-- Not Found State -->
  <div *ngIf="notFound()" class="error-container">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <h2>Tool Not Found</h2>
    <p>The requested tool could not be found.</p>
    <!--<button mat-raised-button color="primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Back to Tools
    </button>-->
  </div>

  <!-- Tool Content -->
   @if (software()) {
  <div class="container">
    <div class="tool-page-content">
      
      <!--
        <div data-widget-tooltip-position="left" data-widget-size="64" class="opeb pull-right" style=" margin-right: 10px;">
          <a href="" href="https://openebench.bsc.es/tool/{{ software()?.biotoolsID | lowercase }}" target="_blank">
            <img src="img/opeb_logo.gif" width="88" title="Monitoring and benchmarking information" alt="OpenEBench">
          </a>
        </div>
      -->

      <!--TODO: add OpenEBench link-->
      <!-- Tool Header -->
      <div class="tool-header-section">
        <div class="header-content">
          <h2>
            {{ software()?.name }} 
            <span matTooltip="Unique tool ID" class="biotools-curie">(biotools:{{ software()?.biotoolsID }})</span>
          </h2>
          <div>
            <!-- version -->
            <div *ngIf="software()?.version" class="pill-spacing version">{{ software()?.version }}</div>
            <!-- topic list -->
            <div *ngIf="software()?.topic?.length" class="pill-spacing">
              <span *ngFor="let topic of software()?.topic" class="topic">{{ topic.term }}</span>
            </div>
            <hr class="pill-hr-divider">
            <!-- maturity, license, cost, accessibility 
             TODO: check if this works with chips instead-->
            <div class="pill-spacing">
              <span *ngIf="software()?.maturity" class="primary">{{ software()?.maturity }}</span>
              <span *ngIf="software()?.license" class="primary">{{ software()?.license }}</span>
              <span *ngIf="software()?.cost" class="primary">{{ software()?.cost }}</span>
              <span *ngIf="software()?.accessibility" class="primary">{{ software()?.accessibility }}</span>
            </div>
            <!-- type, language, OS -->
            <div class="pill-spacing">
              <span *ngIf="software()?.toolType" class="secondary">{{ software()?.toolType }}</span>
              <span *ngIf="software()?.language" class="secondary">{{ software()?.language }}</span>
              <!-- TODO: if no OS error?-->
              <span *ngFor="let os of software()?.operatingSystem">
                <ng-container [ngSwitch]="os.toLowerCase()">
                  <i *ngSwitchCase="'windows'" class="fab fa-windows"></i>
                  <i *ngSwitchCase="'linux'" class="fab fa-linux"></i>
                  <i *ngSwitchCase="'mac'" class="fab fa-apple"></i>
                  <span *ngSwitchDefault>{{ os }}</span>
                </ng-container>
              </span>
            </div>

          </div>
        </div>
        <!--
        <div class="header-actions">
          <button mat-raised-button color="primary" *ngIf="software()?.homepage" 
                  (click)="openHomepage()">
            <mat-icon>home</mat-icon>
            Homepage
          </button>
          <button mat-stroked-button (click)="goBack()">
            <mat-icon>arrow_back</mat-icon>
            Back
          </button>
        </div>
        -->
      </div>

      <!-- Tool Description -->
      <div class="tool-summary-section">
        <div class="summary-item">
          <p>{{ software()?.description }}</p>
        </div>
      </div>

       <!-- Tool Operation Flow Diagram (Input → Function → Output) -->
      <div *ngIf="software()?.function?.length" class="tool-operation-section">
        <div *ngFor="let func of software()?.function" class="function-row">
          
          <!-- Desktop Flow Layout -->
          <div class="function-flow-desktop">
            
            <!-- Inputs with Arrows -->
            <div class="inputs-section">
              <div *ngFor="let input of func.input; let i = index" class="input-row">
                <div class="flow-box input-box">
                  <div class="box-content">
                    <div class="data-term">{{ input.term }}</div>
                    <div *ngIf="input.format?.length" class="data-format">
                      ( <span *ngFor="let format of input.format; let formatLast = last">{{ format.term }}<span *ngIf="!formatLast">, </span></span> )
                    </div>
                  </div>
                </div>
                <div class="arrow-container">
                  <mat-icon class="flow-arrow">arrow_forward</mat-icon>
                </div>
              </div>
            </div>

            <!-- Function/Operation Column -->
            <div class="operation-column">
              <div class="flow-box operation-box">
                <div class="box-content">
                  <div *ngIf="!func.operation?.length" class="operation-term">
                    {{ software()?.name }}
                  </div>
                  <div *ngFor="let operation of func.operation" class="operation-term">
                    {{ operation.term }}
                  </div>
                  <!-- TODO -->
                  <div *ngIf="func.note" class="operation-note">
                    <mat-icon class="info-icon" [matTooltip]="func.note">help_outline</mat-icon>
                  </div>
                  <div *ngIf="func.cmd" class="command-display">
                    <code>{{ func.cmd }}</code>
                  </div>
                </div>
              </div>
            </div>

            <!-- Outputs with Arrows -->
            <div class="outputs-section">
              <div *ngFor="let output of func.output; let i = index" class="output-row">
                <div class="arrow-container">
                  <mat-icon class="flow-arrow">arrow_forward</mat-icon>
                </div>
                <div class="flow-box output-box">
                  <div class="box-content">
                    <div class="data-term">{{ output.term }}</div>
                    <div *ngIf="output.format?.length" class="data-format">
                      ( <span *ngFor="let format of output.format; let formatLast = last">{{ format.term }}<span *ngIf="!formatLast">, </span></span> )
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>

          <!-- Mobile Flow Layout -->
          <div class="function-flow-mobile">
            
            <!-- Inputs -->
            <div *ngIf="func.input?.length" class="mobile-section">
              <div *ngFor="let input of func.input; let i = index" class="flow-box input-box">
                <div class="box-content">
                  <div class="data-term">{{ input.term }}</div>
                  <div *ngIf="input.format?.length" class="data-format">
                    ( <span *ngFor="let format of input.format; let formatLast = last">{{ format.term }}<span *ngIf="!formatLast">, </span></span> )
                  </div>
                </div>
              </div>
            </div>

            <!-- Arrow Down -->
            <div class="mobile-arrow" *ngIf="func.input?.length">
              <mat-icon class="flow-arrow">arrow_downward</mat-icon>
            </div>

            <!-- Function/Operation -->
            <div class="mobile-section">
              <div class="flow-box operation-box">
                <div class="box-content">
                  <div *ngIf="!func.operation?.length" class="operation-term">
                    {{ software()?.name }}
                  </div>
                  <div *ngFor="let operation of func.operation" class="operation-term">
                    {{ operation.term }}
                  </div>
                  <div *ngIf="func.note" class="operation-note">
                    <mat-icon class="info-icon" [matTooltip]="func.note">help_outline</mat-icon>
                  </div>
                </div>
              </div>
              <div *ngIf="func.cmd" class="command-display">
                <code>{{ func.cmd }}</code>
              </div>
            </div>

            <!-- Arrow Down -->
            <div class="mobile-arrow" *ngIf="func.output?.length">
              <mat-icon class="flow-arrow">arrow_downward</mat-icon>
            </div>

            <!-- Outputs -->
            <div *ngIf="func.output?.length" class="mobile-section">
              <div *ngFor="let output of func.output; let i = index" class="flow-box output-box">
                <div class="box-content">
                  <div class="data-term">{{ output.term }}</div>
                  <div *ngIf="output.format?.length" class="data-format">
                    ( <span *ngFor="let format of output.format; let formatLast = last">{{ format.term }}<span *ngIf="!formatLast">, </span></span> )
                  </div>
                </div>
              </div>
            </div>

          </div>
          
          <!-- Function Note -->
          <p *ngIf="func.note" class="function-note">{{ func.note }}</p>
        </div>
      </div>

      <!-- Secondary Sections Row -->
      <div class="secondary-sections-row">
        
        <!-- Credits -->
         @if (software()?.credit?.length) {
        <div class="section-column">
          <div class="section-divider">
            <span>Credits & Support</span>
          </div>
          <div class="credits-content">
            <div *ngFor="let credit of software()?.credit" class="credit-callout">
              <div class="credit-header">
                <strong *ngIf="credit.name">{{ credit.name }}</strong>
                <div class="credit-links">
                  <a *ngIf="credit.email" [href]="'mailto:' + credit.email" class="credit-link">
                    <mat-icon>email</mat-icon>
                  </a>
                  <a *ngIf="credit.url" [href]="credit.url" target="_blank" class="credit-link">
                    <mat-icon>link</mat-icon>
                  </a>
                  <a *ngIf="credit.orcidid" [href]="'https://orcid.org/' + credit.orcidid" target="_blank" class="credit-link">
                    <mat-icon>person</mat-icon>
                  </a>
                </div>
              </div>
              <div *ngIf="credit.typeEntity" class="credit-entity">{{ credit.typeEntity }}</div>
              <div *ngIf="credit.typeRole?.length" class="credit-roles">
                <span *ngFor="let role of credit.typeRole" class="role-tag">{{ role }}</span>
              </div>
              <p *ngIf="credit.note" class="credit-note">{{ credit.note }}</p>
            </div>
          </div>
        </div>
        }
        <!-- Documentation -->
        @if (software()?.documentation?.length) {
        <div class="section-column">
          <div class="section-divider">
            <span>Documentation</span>
          </div>
          <div class="documentation-content">
            <div *ngFor="let doc of software()?.documentation" class="doc-callout">
              <div class="doc-header">
                <mat-icon class="doc-icon">description</mat-icon>
                <div class="doc-info">
                  <strong>{{ doc.type }}</strong>
                  <a [href]="doc.url" target="_blank" class="doc-link">{{ doc.url }}</a>
                </div>
              </div>
              <p *ngIf="doc.note" class="doc-note">{{ doc.note }}</p>
            </div>
          </div>
        </div>
        }
        <!-- Downloads -->
        @if (software()?.download?.length) {
        <div class="section-column">
          <div class="section-divider">
            <span>Downloads</span>
          </div>
          <div class="downloads-content">
            <div *ngFor="let download of software()?.download" class="download-callout">
              <div class="download-header">
                <mat-icon class="download-icon">download</mat-icon>
                <div class="download-info">
                  <strong>{{ download.type }}</strong>
                  <a [href]="download.url" target="_blank" class="download-link">{{ download.url }}</a>
                </div>
              </div>
              <p *ngIf="download.note" class="download-note">{{ download.note }}</p>
            </div>
          </div>
        </div>
        }
      </div>

      <!-- Publications Detail -->
       @if (software()?.publication?.length) {
      <div class="publications-detail-section">
        <div class="section-divider">
          <span>Publications</span>
        </div>
        <div class="publications-content">
          <div *ngFor="let pub of software()?.publication" class="publication-item">
            <div class="publication-header">
              <div class="publication-type">
                <span class="type-badge" [class]="pub.type?.[0] === 'Primary' ? 'primary' : 'secondary'">
                  {{ pub.type?.[0] || 'Publication' }}
                </span>
              </div>
            </div>
            <div class="publication-ids">
              <div *ngIf="pub.doi" class="publication-id">
                <strong>DOI:</strong> 
                <a [href]="'https://doi.org/' + pub.doi" target="_blank">{{ pub.doi }}</a>
              </div>
              <div *ngIf="pub.pmid" class="publication-id">
                <strong>PMID:</strong> 
                <a [href]="'https://pubmed.ncbi.nlm.nih.gov/' + pub.pmid" target="_blank">{{ pub.pmid }}</a>
              </div>
              <div *ngIf="pub.pmcid" class="publication-id">
                <strong>PMCID:</strong> 
                <a [href]="'https://www.ncbi.nlm.nih.gov/pmc/articles/' + pub.pmcid" target="_blank">{{ pub.pmcid }}</a>
              </div>
            </div>
            <p *ngIf="pub.note" class="publication-note">{{ pub.note }}</p>
          </div>
        </div>
      </div>
    }
      <!-- ELIXIR Info -->
      <div class="elixir-info-section">
        <div class="section-divider">
          <span>ELIXIR bio.tools</span>
        </div>
        <div class="elixir-content">
          <div class="elixir-text">
            <p>
              This tool description is part of ELIXIR bio.tools, a comprehensive registry of 
              software tools and data resources for the life sciences.
            </p>
            <div class="elixir-metadata">
              <div class="metadata-item">
                <strong>bio.tools ID:</strong> {{ software()?.biotoolsID }}
              </div>
            </div>
            <div class="elixir-actions">
              <button mat-raised-button color="primary" >
                <mat-icon>open_in_new</mat-icon>
                View in bio.tools
              </button>
            </div>
          </div>
          <div class="elixir-logo">
            <img src="/img/ELIXIR_logo_white_background.png" alt="ELIXIR Logo" class="logo-image">
          </div>
        </div>
      </div>

      <!-- Community -->
      <div class="community-section">
        <div class="section-divider">
          <span>Community</span>
        </div>
        <div class="community-content">
          <div class="community-text">
            <h4>Get Involved</h4>
            <p>Help improve this tool description by contributing to the bio.tools community.</p>
            <div class="community-actions">
              <button mat-raised-button color="accent">
                <mat-icon>group_add</mat-icon>
                Join Community
              </button>
              <button mat-stroked-button>
                <mat-icon>forum</mat-icon>
                Discussions
              </button>
              <button mat-stroked-button>
                <mat-icon>help</mat-icon>
                Get Help
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
  }
</div>